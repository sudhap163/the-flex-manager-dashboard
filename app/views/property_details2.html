<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spacious 2 Bed Flat in Hoxton</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Function to fetch and display approved reviews
        async function fetchApprovedReviews() {
            try {
                // Fetch approved reviews for a specific listing
                const listingName = '2B N1 A - 29 Shoreditch Heights';
                const encodedListingName = encodeURIComponent(listingName);
                const response = await fetch(`http://127.0.0.1:5000/api/reviews/approved/${encodedListingName}`);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                const reviewsContainer = document.getElementById('reviews-container');
                reviewsContainer.innerHTML = '';
                
                const reviews = data.result;
                const reviewCount = reviews.length;
                let totalRatingSum = 0;
                
                if (reviewCount === 0) {
                    reviewsContainer.innerHTML = '<p class="text-gray-500 text-center">No approved reviews yet.</p>';
                } else {
                    reviews.forEach(review => {
                        const ratings = review.categoryRatings.map(cat => cat.rating);
                        const avgRating = ratings.length > 0 ? ratings.reduce((sum, current) => sum + current, 0) / ratings.length : 0;
                        totalRatingSum += avgRating;
                        
                        const starRating = Math.round(avgRating / 2);
                        
                        const reviewCard = document.createElement('div');
                        reviewCard.className = 'bg-white rounded-lg shadow p-6';
                        reviewCard.innerHTML = `
                            <div class="flex items-center mb-2">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center font-bold text-gray-700 mr-4">
                                    ${review.reviewerName.charAt(0)}
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">${review.reviewerName}</p>
                                    <p class="text-xs text-gray-500">${new Date(review.submittedAt).toLocaleDateString()}</p>
                                </div>
                            </div>
                            <div class="flex items-center text-yellow-500 mb-2">
                                ${'★'.repeat(starRating)}
                                <span class="ml-2 text-gray-700 text-sm">(${starRating} / 5)</span>
                            </div>
                            <p class="text-gray-700">${review.publicReview}</p>
                        `;
                        reviewsContainer.appendChild(reviewCard);
                    });
                }
                
                // Calculate and update overall rating and count
                const overallRating = reviewCount > 0 ? (totalRatingSum / reviewCount) / 2 : 0;
                const overallStarRating = Math.round(overallRating / 2);

                const mainRatingValue = document.getElementById('main-rating-value');
                const mainStars = document.getElementById('main-stars');
                const mainReviewCount = document.getElementById('main-review-count');
                const reviewHeaderRating = document.getElementById('review-header-rating');

                if (mainRatingValue) mainRatingValue.textContent = overallRating.toFixed(2);
                if (mainStars) mainStars.textContent = '★'.repeat(overallStarRating);
                if (mainReviewCount) mainReviewCount.textContent = `${reviewCount} reviews`;
                if (reviewHeaderRating) reviewHeaderRating.textContent = `${overallRating.toFixed(2)} (${reviewCount})`;


            } catch (error) {
                console.error("Failed to fetch approved reviews:", error);
                const reviewsContainer = document.getElementById('reviews-container');
                reviewsContainer.innerHTML = '<p class="text-red-500 text-center">Failed to load reviews. Please ensure the Python backend is running.</p>';
            }
        }
        
        window.onload = fetchApprovedReviews;

    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
        }
        .text-dark-green {
            color: #1a4f4d;
        }
        .bg-dark-green {
            background-color: #1a4f4d;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Navbar -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 bg-dark-green rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-9v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                </div>
                <span class="text-xl font-bold text-gray-900">Flex Living</span>
            </div>
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-600 hover:text-dark-green font-medium">Flex Living</a>
                <a href="#" class="text-dark-green font-bold">All Listings</a>
                <a href="#" class="text-gray-600 hover:text-dark-green font-medium">About Us</a>
                <a href="#" class="text-gray-600 hover:text-dark-green font-medium">Contact Us</a>
            </nav>
            <button class="md:hidden text-gray-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                </svg>
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Image Gallery (Full Width) -->
        <div class="grid grid-cols-1 md:grid-cols-2 md:grid-rows-1 gap-4">
            <div class="md:col-span-1 md:row-span-2 relative overflow-hidden rounded-xl h-64 md:h-[500px]">
                <img src="./images/living-room.webp" onerror="this.onerror=null;this.src='https://placehold.co/1200x800/e0e0e0/000000?text=Living+Room';" alt="Living room and dining area" class="w-full h-full object-cover">
                <div class="absolute top-4 right-4 bg-dark-green bg-opacity-70 backdrop-blur-sm text-white text-sm font-semibold px-3 py-1 rounded-full flex items-center space-x-1">
                    <span id="main-rating-value" class="text-white"></span> <span id="main-stars"></span>
                </div>
            </div>
            <div class="hidden md:grid md:col-span-1 grid-rows-2 gap-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="overflow-hidden rounded-xl h-64 md:h-[242px]">
                        <img src="./images/bedroom1.webp" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/000000?text=Bedroom+1';" alt="Main bedroom" class="w-full h-full object-cover">
                    </div>
                    <div class="overflow-hidden rounded-xl h-64 md:h-[242px]">
                        <img src="./images/bedroom2.webp" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/000000?text=Bathroom';" alt="Bathroom" class="w-full h-full object-cover">
                    </div>
                </div>
                <!-- Third and Fourth images side-by-side -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="overflow-hidden rounded-xl h-64 md:h-[242px]">
                        <img src="./images/bathroom1.webp" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/000000?text=Bedroom+2';" alt="Second bedroom" class="w-full h-full object-cover">
                    </div>
                    <div class="relative overflow-hidden rounded-xl h-64 md:h-[242px]">
                        <img src="./images/bathroom2.webp" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/000000?text=Kitchen';" alt="Kitchen" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <button class="text-white text-lg font-semibold flex items-center space-x-2">
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                                </svg>
                                <span>+39 photos</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr class="border-t border-gray-200 my-8">
        
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column: Details, Amenities, Reviews, etc. -->
            <div class="md:col-span-2 space-y-8">
                <!-- Property Details -->
                <div class="space-y-4">
                    <h1 class="text-4xl font-bold text-gray-900">Spacious 2 Bed Flat in Hoxton</h1>
                    <div class="flex items-center text-gray-500 space-x-4">
                        <span>Apartment</span>
                        <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
                        <span>5 guests</span>
                        <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
                        <span>2 bedrooms</span>
                        <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
                        <span>2 bathrooms</span>
                    </div>
                    <div class="flex items-center space-x-2 text-dark-green">
                        <span id="main-stars" class="text-yellow-400"></span>
                        <span id="main-rating-value" class="font-bold"></span>
                        <a id="main-review-count" href="#reviews-container" class="underline font-medium"></a>
                    </div>
                    <p class="text-gray-700 leading-relaxed">
                        This apartment is located in Hoxton, one of the coolest areas in London. It's a spacious unit with high-quality amenities to make your stay comfortable. The location is ideal—close to great cafes, shops, and bars, with easy access to transport. I've made sure everything is ready for you to enjoy your stay.
                    </p>
                    <a href="#" class="text-dark-green font-medium hover:underline">Show more</a>
                </div>

                <hr class="border-t border-gray-200">

                <!-- Amenities Section -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Amenities</h2>
                    <div class="grid grid-cols-2 gap-y-4">
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M17.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Free WiFi</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Internet</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Private living room</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Essentials</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Towels</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12.5 12.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 17.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 7.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                            </svg>
                            <span>Kitchen</span>
                        </div>
                    </div>
                    <a href="#" class="text-dark-green font-medium hover:underline">Show all 48 amenities</a>
                </div>

                <hr class="border-t border-gray-200">

                <!-- Available Days/Calendar -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Available days</h2>
                    <div class="flex justify-center items-center space-x-4 w-full">
                        <button class="text-gray-500 hover:text-gray-700 p-2 rounded-full">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="grid grid-cols-2 gap-4 flex-grow">
                            <!-- September Calendar -->
                            <div class="text-center">
                                <p class="font-semibold text-gray-800 mb-2">September 2025</p>
                                <div class="grid grid-cols-7 text-sm text-gray-500 gap-1">
                                    <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                                </div>
                                <div class="grid grid-cols-7 text-sm text-gray-700 mt-2 gap-1">
                                    <span class="opacity-50">31</span>
                                    <span>1</span><span>2</span><span>3</span><span class="font-bold">4</span><span class="font-bold">5</span><span class="font-bold">6</span>
                                    <span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span>
                                    <span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span class="font-bold">20</span>
                                    <span class="font-bold">21</span><span class="font-bold">22</span><span class="font-bold">23</span><span class="font-bold">24</span><span class="font-bold">25</span><span class="font-bold">26</span><span class="font-bold">27</span>
                                    <span>28</span><span>29</span><span>30</span>
                                </div>
                            </div>
                            <!-- October Calendar -->
                            <div class="text-center">
                                <p class="font-semibold text-gray-800 mb-2">October 2025</p>
                                <div class="grid grid-cols-7 text-sm text-gray-500 gap-1">
                                    <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                                </div>
                                <div class="grid grid-cols-7 text-sm text-gray-700 mt-2 gap-1">
                                    <span class="opacity-50"></span>
                                    <span class="font-bold">1</span><span class="font-bold">2</span><span class="font-bold">3</span><span class="font-bold">4</span>
                                    <span class="font-bold">5</span><span class="font-bold">6</span><span class="font-bold">7</span><span class="font-bold">8</span><span class="font-bold">9</span><span class="font-bold">10</span><span class="font-bold">11</span>
                                    <span class="font-bold">12</span><span class="font-bold">13</span><span class="font-bold">14</span><span class="font-bold">15</span><span class="font-bold">16</span><span class="font-bold">17</span><span class="font-bold">18</span>
                                    <span class="font-bold">19</span><span class="font-bold">20</span><span class="font-bold">21</span><span class="font-bold">22</span><span class="font-bold">23</span><span class="font-bold">24</span><span class="font-bold">25</span>
                                    <span class="font-bold">26</span><span class="font-bold">27</span><span class="font-bold">28</span><span class="font-bold">29</span><span class="font-bold">30</span><span class="font-bold">31</span>
                                </div>
                            </div>
                        </div>
                        <button class="text-gray-500 hover:text-gray-700 p-2 rounded-full">
                            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                    <div class="flex items-center justify-between text-gray-500 text-sm mt-4">
                        <p>Select check-in and check-out dates</p>
                        <button class="text-dark-green font-medium hover:underline">Clear dates</button>
                    </div>
                </div>

                <hr class="border-t border-gray-200">

                <!-- Reviews Section -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Reviews <span id="review-header-rating" class="text-gray-500 font-normal"></span></h2>
                    <div id="reviews-container" class="space-y-6">
                        <!-- Approved reviews will be dynamically inserted here by the JavaScript function -->
                    </div>
                </div>

                <hr class="border-t border-gray-200">

                <!-- Good to Know Section -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Good to know</h2>
                    <h3 class="text-lg font-medium text-gray-800">House Rules</h3>
                    <div class="grid grid-cols-2 gap-y-2 text-gray-700">
                        <span>Check-in: 3 pm</span>
                        <span>Pets: not allowed</span>
                        <span>Check-out: 10 am</span>
                        <span>Smoking inside: not allowed</span>
                    </div>
                    <a href="#" class="text-dark-green font-medium hover:underline">Show more</a>
                </div>

                <hr class="border-t border-gray-200">

                <!-- Cancellation Policy -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Cancellation policy</h2>
                    <p class="text-gray-700">100% refund up to 14 days before arrival</p>
                </div>
            </div>

            <!-- Right Column: Booking Form -->
            <div class="md:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                    <p class="text-sm text-gray-600 mb-4">Select dates and number of guests to see the total price per night</p>
                    <div class="space-y-4">
                        <div class="relative">
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-dark-green focus:border-dark-green pl-12" placeholder="Select Dates">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </span>
                        </div>
                        <div class="relative">
                            <input type="number" min="1" value="1" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-dark-green focus:border-dark-green pl-12">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="w-full bg-dark-green text-white font-medium py-3 rounded-xl hover:bg-opacity-90 transition-colors">Book now</button>
                            <button class="w-full bg-white text-dark-green font-medium py-3 rounded-xl border border-dark-green hover:bg-gray-100 transition-colors">Send Inquiry</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-inner mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-dark-green rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-9v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                </div>
                <div class="flex items-center space-x-4 text-gray-600">
                    <a href="#" class="hover:underline">Privacy Policy</a>
                    <a href="#" class="hover:underline">Terms and conditions</a>
                </div>
            </div>
            <div class="flex items-center space-x-6 text-gray-600">
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.948V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                    <span>+44 7723 745646</span>
                </div>
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <span>info@theflexliving.com</span>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>
